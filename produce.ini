[]
train = java -classpath bin epar.Train
decode = java -classpath bin epar.Decode

[output/sample/out%{i}]
models = %{'output/sample/model' + str(j) for j in range(1, int(i) + 1)}
deps = %{models}
recipe =
	mkdir -p output/sample
	%{decode} data/sample/input.txt data/sample/rules.binary data/sample/rules.unary %{target} %{models} 2> %{target}.log

[output/sample/model0]
recipe = touch %{target}

[output/sample/model%{i}]
dep.model = output/sample/model%{int(i) - 1}
recipe =
	mkdir -p output/sample
	%{train} data/sample/train.input data/sample/train.txt data/sample/rules.binary data/sample/rules.unary %{model} %{target} 2> %{target}.log
